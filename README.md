# MODX Docker

## Описание проекта

Этот проект представляет собой Docker-контейнеризованную установку MODX Revolution. Проект использует Docker Compose для оркестрации трех основных сервисов: Nginx (веб-сервер), PHP-FPM (обработчик PHP) и MySQL (база данных). Это позволяет легко развернуть и управлять средой разработки для MODX.

В этой настройке MODX работает в контейнере с PHP 8.1, Nginx и MySQL 8.0.

## Предварительные требования

- Docker (версия 20.10 или выше)
- Docker Compose (версия 1.29 или выше)
- Git (для клонирования репозитория)
- Минимум 2 ГБ свободной оперативной памяти
- Минимум 5 ГБ свободного дискового пространства

## Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone <URL_репозитория> modx-docker
   cd modx-docker
   ```

2. **Убедитесь, что порты свободны:**
   - Порт 80 (Nginx)
   - Порт 3306 (MySQL, если нужен внешний доступ)

3. **Запустите контейнеры:**
   ```bash
   docker-compose up -d
   ```

4. **Дождитесь инициализации:**
   - Первый запуск может занять несколько минут, так как MySQL инициализирует базу данных.

5. **Проверьте статус:**
   ```bash
   docker-compose ps
   ```

## Запуск и использование

### Запуск в фоне
```bash
docker-compose up -d
```

### Остановка
```bash
docker-compose down
```

### Просмотр логов
```bash
docker-compose logs -f
```

### Доступ к приложению
- **MODX Manager (админ-панель):** http://localhost/manager/
- **Основной сайт:** http://localhost/

## Архитектура проекта

Проект построен на микросервисной архитектуре с использованием Docker:

### Сервисы
- **nginx**: Веб-сервер на базе Alpine Linux. Обрабатывает HTTP-запросы, обслуживает статические файлы и проксирует PHP-запросы к PHP-FPM.
- **php**: PHP-FPM контейнер на базе Alpine с PHP 8.1. Выполняет PHP-код MODX, включает необходимые расширения (PDO, Zip) и Composer.
- **mysql**: База данных MySQL 8.0. Хранит данные MODX, инициализируется скриптом при первом запуске.

### Сеть
- Все сервисы подключены к внутренней сети `modx-network` для безопасного общения.
- Nginx доступен извне на порту 80, MySQL — на порту 3306 (для внешнего доступа).

### Хранилище
- **mysql_data**: Named volume для постоянного хранения данных MySQL.
- **Монтирование директорий:** Код MODX монтируется в контейнеры для удобства разработки.

## Структура файлов и директорий

```
/modx-docker/
├── docker-compose.yml          # Оркестрация сервисов
├── .gitignore                  # Игнорируемые файлы (кеш, логи)
├── nginx/
│   └── default.conf            # Конфигурация Nginx
├── php/
│   └── Dockerfile              # Сборка PHP-контейнера
├── mysql/
│   └── init.sql                # Инициализация базы данных
└── www/                        # Корневая директория MODX
    ├── index.php               # Точка входа MODX
    ├── config.core.php         # Основная конфигурация MODX
    ├── core/                   # Ядро MODX (модель, контроллеры, etc.)
    │   ├── cache/              # Кеш MODX
    │   ├── components/         # Компоненты (pdotools и др.)
    │   ├── config/             # Конфигурационные файлы
    │   ├── docs/               # Документация MODX
    │   ├── error/              # Обработчики ошибок
    │   ├── export/             # Экспорт данных
    │   ├── import/             # Импорт данных
    │   ├── lexicon/            # Лексиконы (переводы)
    │   ├── model/              # Модель данных (xPDO)
    │   └── packages/           # Установленные пакеты
    ├── manager/                # Админ-панель MODX
    ├── connectors/             # API-коннекторы
    └── assets/                 # Статические ресурсы
        └── components/          # Ресурсы компонентов
```

### База данных
- **MYSQL_ROOT_PASSWORD**: rootpassword
- **MYSQL_DATABASE**: modx_db
- **MYSQL_USER**: modx_user
- **MYSQL_PASSWORD**: modx_password
